<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> SCADA Traffic Analyzer</title>
    <style>
        :root {
            --bg-color: #f4f4f9;
            --panel-bg: #ffffff;
            --text-color: #222;
            --focus-ring: #005fcc;
            --border-color: #333;
        }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; background: var(--bg-color); color: var(--text-color); display: flex; gap: 20px; flex-wrap: wrap; }
        
        /* Focus Styles for Accessibility */
        button:focus, div[tabindex="0"]:focus {
            outline: 4px solid var(--focus-ring);
            outline-offset: 2px;
        }

        .main-col { flex: 2; min-width: 300px; display: flex; flex-direction: column; gap: 20px; }
        .sidebar { flex: 1; min-width: 250px; display: flex; flex-direction: column; gap: 20px; }

        /* Diagram Box */
        .diagram-box { background: var(--panel-bg); padding: 20px; border: 2px solid var(--border-color); border-radius: 8px; position: relative; }
        
        .device-node {
            display: inline-block; width: 140px; padding: 10px; margin: 10px;
            background: #eee; border: 2px solid #555; border-radius: 4px;
            text-align: center; font-weight: bold; position: relative;
        }
        /* Visual flash state */
        .device-node.active { background-color: #bbdefb; border-color: #1565c0; } 
        .device-node.compromised { background-color: #ffcdd2; border-color: #c62828; }

        /* Log Panel */
        .log-panel { 
            height: 300px; background: #222; color: #fff; 
            border-radius: 4px; padding: 10px; overflow-y: auto; 
            font-family: 'Courier New', monospace; border: 2px solid #555;
        }
        .log-entry { margin-bottom: 8px; padding-left: 10px; border-left: 4px solid transparent; }
        .log-entry.normal { border-color: #69f0ae; } /* Green */
        .log-entry.alert { border-color: #ff5252; background: #3e2723; } /* Red bg for contrast */

        /* Controls */
        .control-group { background: white; padding: 15px; border: 1px solid #ccc; border-radius: 4px; }
        .btn {
            width: 100%; padding: 12px; margin-bottom: 10px; 
            font-size: 1rem; font-weight: bold; cursor: pointer; 
            background: #eee; border: 2px solid #555; border-radius: 4px;
            text-align: left;
        }
        .btn:hover { background: #e0e0e0; }
        .btn-attack { border-left: 6px solid #d32f2f; }
        .btn-normal { border-left: 6px solid #2e7d32; }

    </style>
</head>
<body>

    <main class="main-col">
        <section class="diagram-box" aria-label="Network Diagram">
            <h2 style="margin-top:0;">Network Map</h2>
            <div style="text-align: center;">
                <div id="hmi" class="device-node">
                    HMI<br><span style="font-size:0.8rem">192.168.1.10</span>
                </div>
                <div id="eng" class="device-node">
                    Eng. Station<br><span style="font-size:0.8rem">192.168.1.15</span>
                </div>
                <div style="height: 30px; border-left: 2px dashed #000; margin: 0 auto; width: 0;"></div>
                <div id="plc" class="device-node">
                    PLC Master<br><span style="font-size:0.8rem">192.168.1.50</span>
                </div>
            </div>
        </section>

        <section aria-labelledby="log-heading">
            <h2 id="log-heading">Live Traffic Log</h2>
            <div class="log-panel" id="log-display" aria-live="polite" aria-relevant="additions">
                <div class="log-entry normal">System Ready. Waiting for traffic...</div>
            </div>
        </section>
    </main>

    <aside class="sidebar">
        <div class="control-group">
            <h3>1. Normal Operations</h3>
            <button class="btn btn-normal" onclick="runScenario('poll')">Run Status Poll (HMI &rarr; PLC)</button>
            <button class="btn btn-normal" onclick="runScenario('upload')">Upload Logic (Eng &rarr; PLC)</button>
        </div>

        <div class="control-group">
            <h3>2. Attack Scenarios</h3>
            <button class="btn btn-attack" onclick="runScenario('flood')">Trigger DoS Flood</button>
            <button class="btn btn-attack" onclick="runScenario('injection')">Trigger Command Injection</button>
        </div>
    </aside>

    <script>
        const logs = document.getElementById('log-display');

        function addLog(text, type='normal') {
            const row = document.createElement('div');
            const time = new Date().toLocaleTimeString();
            row.className = `log-entry ${type}`;
            // Adding specific text prefix for screen readers
            const prefix = type === 'alert' ? 'ALERT: ' : 'INFO: ';
            row.innerHTML = `<span aria-hidden="true">${time}</span> <b>${prefix}</b> ${text}`;
            logs.appendChild(row);
            logs.scrollTop = logs.scrollHeight;
        }

        function flashDevice(id, type) {
            const el = document.getElementById(id);
            const cls = type === 'alert' ? 'compromised' : 'active';
            el.classList.add(cls);
            setTimeout(() => el.classList.remove(cls), 500);
        }

        function runScenario(type) {
            if (type === 'poll') {
                flashDevice('hmi', 'normal');
                flashDevice('plc', 'normal');
                addLog("192.168.1.10 sent MODBUS [Read Request] to PLC.");
                setTimeout(() => addLog("PLC sent MODBUS [Data OK] back to HMI."), 800);
            } 
            else if (type === 'upload') {
                flashDevice('eng', 'normal');
                flashDevice('plc', 'normal');
                addLog("192.168.1.15 established CIP Session with PLC for Logic Upload.");
            }
            else if (type === 'flood') {
                flashDevice('hmi', 'alert');
                flashDevice('plc', 'alert');
                addLog("High Traffic Volume detected! 500 packets/sec from unknown source.", 'alert');
                setTimeout(() => addLog("PLC availability compromised. Dropping packets.", 'alert'), 1000);
            }
            else if (type === 'injection') {
                flashDevice('eng', 'alert');
                flashDevice('plc', 'alert');
                addLog("192.168.1.15 sent UNAUTHORIZED Modbus Write Command to Safety System!", 'alert');
            }
        }
    </script>
</body>
</html>
